{"ast":null,"code":"import { db, admin } from '../../../lib/firebase';\nimport auth0 from '../../../lib/auth0';\nimport getCurrentDate from '../../../util/getCurrentDate';\nexport default async function store(req, res) {\n  const {\n    symptoms\n  } = req.body;\n  const {\n    latitude,\n    longitude\n  } = req.body.coords;\n  const session = await auth0.getSession(req);\n  if (!session) return res.status(401).json({\n    error: 'Unauthenticated user'\n  });\n  const currentDate = getCurrentDate();\n  const {\n    sub: userId\n  } = session.user;\n  console.log(userId);\n  console.log(currentDate);\n  await db.collection('users').doc(userId).collection('history').add({\n    date: currentDate,\n    symptoms,\n    status: 'covid',\n    coordinates: {\n      latitude,\n      longitude\n    }\n  }); // await db\n  //   .collection('history')\n  //   .doc(currentDate)\n  //   .collection('all')\n  //   .add({\n  //     coordinates: new admin.firestore.GeoPoint(latitude, longitude),\n  //     status: 'covid',\n  //   });\n\n  return res.send({\n    ok: true\n  });\n}","map":{"version":3,"sources":["/home/thiago/Documentos/Dev/Projetos/fullstack-lab/pages/api/status/store.js"],"names":["db","admin","auth0","getCurrentDate","store","req","res","symptoms","body","latitude","longitude","coords","session","getSession","status","json","error","currentDate","sub","userId","user","console","log","collection","doc","add","date","coordinates","send","ok"],"mappings":"AAAA,SAASA,EAAT,EAAaC,KAAb,QAA0B,uBAA1B;AACA,OAAOC,KAAP,MAAkB,oBAAlB;AACA,OAAOC,cAAP,MAA2B,8BAA3B;AAEA,eAAe,eAAeC,KAAf,CAAqBC,GAArB,EAA0BC,GAA1B,EAA+B;AAC5C,QAAM;AAAEC,IAAAA;AAAF,MAAeF,GAAG,CAACG,IAAzB;AACA,QAAM;AAAEC,IAAAA,QAAF;AAAYC,IAAAA;AAAZ,MAA0BL,GAAG,CAACG,IAAJ,CAASG,MAAzC;AAEA,QAAMC,OAAO,GAAG,MAAMV,KAAK,CAACW,UAAN,CAAiBR,GAAjB,CAAtB;AAEA,MAAI,CAACO,OAAL,EAAc,OAAON,GAAG,CAACQ,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAAEC,IAAAA,KAAK,EAAE;AAAT,GAArB,CAAP;AAEd,QAAMC,WAAW,GAAGd,cAAc,EAAlC;AAEA,QAAM;AAAEe,IAAAA,GAAG,EAAEC;AAAP,MAAkBP,OAAO,CAACQ,IAAhC;AAEAC,EAAAA,OAAO,CAACC,GAAR,CAAYH,MAAZ;AACAE,EAAAA,OAAO,CAACC,GAAR,CAAYL,WAAZ;AAEA,QAAMjB,EAAE,CAACuB,UAAH,CAAc,OAAd,EAAuBC,GAAvB,CAA2BL,MAA3B,EAAmCI,UAAnC,CAA8C,SAA9C,EAAyDE,GAAzD,CAA6D;AACjEC,IAAAA,IAAI,EAAET,WAD2D;AAEjEV,IAAAA,QAFiE;AAGjEO,IAAAA,MAAM,EAAE,OAHyD;AAIjEa,IAAAA,WAAW,EAAE;AACXlB,MAAAA,QADW;AAEXC,MAAAA;AAFW;AAJoD,GAA7D,CAAN,CAf4C,CAyB5C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,SAAOJ,GAAG,CAACsB,IAAJ,CAAS;AAAEC,IAAAA,EAAE,EAAE;AAAN,GAAT,CAAP;AACD","sourcesContent":["import { db, admin } from '../../../lib/firebase';\nimport auth0 from '../../../lib/auth0';\nimport getCurrentDate from '../../../util/getCurrentDate';\n\nexport default async function store(req, res) {\n  const { symptoms } = req.body;\n  const { latitude, longitude } = req.body.coords;\n\n  const session = await auth0.getSession(req);\n\n  if (!session) return res.status(401).json({ error: 'Unauthenticated user' });\n\n  const currentDate = getCurrentDate();\n\n  const { sub: userId } = session.user;\n\n  console.log(userId);\n  console.log(currentDate);\n\n  await db.collection('users').doc(userId).collection('history').add({\n    date: currentDate,\n    symptoms,\n    status: 'covid',\n    coordinates: {\n      latitude,\n      longitude,\n    },\n  });\n\n  // await db\n  //   .collection('history')\n  //   .doc(currentDate)\n  //   .collection('all')\n  //   .add({\n  //     coordinates: new admin.firestore.GeoPoint(latitude, longitude),\n  //     status: 'covid',\n  //   });\n\n  return res.send({ ok: true });\n}\n"]},"metadata":{},"sourceType":"module"}