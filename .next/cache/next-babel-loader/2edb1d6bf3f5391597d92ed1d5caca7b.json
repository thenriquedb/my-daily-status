{"ast":null,"code":"import { db } from '../../lib/firebase';\nimport getCurrentDate from '../../util/getCurrentDate';\nexport default async function (req, res) {\n  const {\n    filter = 'all',\n    radius = 1000,\n    latitude,\n    longitude\n  } = req.query;\n  let nearbyUsers;\n  const currentDate = getCurrentDate();\n\n  switch (filter.toLowerCase()) {\n    case 'covid':\n    case 'suspect':\n      nearbyUsers = await db.collection('history').doc(currentDate).collection('all').where('status', '==', filter).near({\n        center: {\n          latitude: parseFloat(latitude),\n          longitude: parseFloat(longitude)\n        },\n        radius: parseFloat(radius) * 1000\n      }).get();\n      break;\n\n    default:\n      nearbyUsers = await db.collection('history').doc(currentDate).collection('all').near({\n        center: {\n          latitude: parseFloat(latitude),\n          longitude: parseFloat(longitude)\n        },\n        radius: parseFloat(radius) * 1000\n      }).get();\n      break;\n  }\n\n  const nearbyUsersList = [];\n\n  if (nearbyUsers.docs) {\n    nearbyUsers.docs.forEach(doc => {\n      nearbyUsersList.push({\n        id: doc.id,\n        status: doc.data().status,\n        coordinates: {\n          latitude: doc.data().coordinates.latitude,\n          longitude: doc.data().coordinates.longitude\n        }\n      });\n    });\n  }\n\n  return res.status(200).json({\n    nearbyUsers: nearbyUsersList.slice(1, nearbyUsersList.length - 1)\n  });\n}","map":null,"metadata":{},"sourceType":"module"}