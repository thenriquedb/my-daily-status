{"ast":null,"code":"import { db, admin } from '../../../lib/firebase';\nimport auth0 from '../../../lib/auth0';\nimport getCurrentDate from '../../../util/getCurrentDate';\nexport default async function store(req, res) {\n  const {\n    symptoms = [],\n    userId\n  } = req.body;\n  const {\n    latitude,\n    longitude\n  } = req.body.coords;\n  console.log(req.body);\n  const session = await auth0.getSession(req);\n  if (!session) return res.status(401).json({\n    error: 'Unauthenticated user'\n  });\n  const currentDate = getCurrentDate(); // const { sub: userId } = session.user;\n\n  await db.collection('users').doc(userId).collection('history').doc(currentDate).set({\n    symptoms,\n    status: 'covid',\n    coordinates: {\n      latitude,\n      longitude\n    }\n  });\n  await db.collection('history').doc(currentDate).collection('all').add({\n    user: userId,\n    symptoms,\n    coordinates: new admin.firestore.GeoPoint(latitude, longitude),\n    status: 'covid'\n  });\n  return res.status(200).end();\n}","map":{"version":3,"sources":["/home/thiago/Documentos/Dev/Projetos/fullstack-lab/pages/api/status/store.js"],"names":["db","admin","auth0","getCurrentDate","store","req","res","symptoms","userId","body","latitude","longitude","coords","console","log","session","getSession","status","json","error","currentDate","collection","doc","set","coordinates","add","user","firestore","GeoPoint","end"],"mappings":"AAAA,SAASA,EAAT,EAAaC,KAAb,QAA0B,uBAA1B;AACA,OAAOC,KAAP,MAAkB,oBAAlB;AACA,OAAOC,cAAP,MAA2B,8BAA3B;AAEA,eAAe,eAAeC,KAAf,CAAqBC,GAArB,EAA0BC,GAA1B,EAA+B;AAC5C,QAAM;AAAEC,IAAAA,QAAQ,GAAG,EAAb;AAAiBC,IAAAA;AAAjB,MAA4BH,GAAG,CAACI,IAAtC;AACA,QAAM;AAAEC,IAAAA,QAAF;AAAYC,IAAAA;AAAZ,MAA0BN,GAAG,CAACI,IAAJ,CAASG,MAAzC;AACAC,EAAAA,OAAO,CAACC,GAAR,CAAYT,GAAG,CAACI,IAAhB;AACA,QAAMM,OAAO,GAAG,MAAMb,KAAK,CAACc,UAAN,CAAiBX,GAAjB,CAAtB;AAEA,MAAI,CAACU,OAAL,EAAc,OAAOT,GAAG,CAACW,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAAEC,IAAAA,KAAK,EAAE;AAAT,GAArB,CAAP;AAEd,QAAMC,WAAW,GAAGjB,cAAc,EAAlC,CAR4C,CAU5C;;AAEA,QAAMH,EAAE,CACLqB,UADG,CACQ,OADR,EAEHC,GAFG,CAECd,MAFD,EAGHa,UAHG,CAGQ,SAHR,EAIHC,GAJG,CAICF,WAJD,EAKHG,GALG,CAKC;AACHhB,IAAAA,QADG;AAEHU,IAAAA,MAAM,EAAE,OAFL;AAGHO,IAAAA,WAAW,EAAE;AACXd,MAAAA,QADW;AAEXC,MAAAA;AAFW;AAHV,GALD,CAAN;AAcA,QAAMX,EAAE,CACLqB,UADG,CACQ,SADR,EAEHC,GAFG,CAECF,WAFD,EAGHC,UAHG,CAGQ,KAHR,EAIHI,GAJG,CAIC;AACHC,IAAAA,IAAI,EAAElB,MADH;AAEHD,IAAAA,QAFG;AAGHiB,IAAAA,WAAW,EAAE,IAAIvB,KAAK,CAAC0B,SAAN,CAAgBC,QAApB,CAA6BlB,QAA7B,EAAuCC,SAAvC,CAHV;AAIHM,IAAAA,MAAM,EAAE;AAJL,GAJD,CAAN;AAWA,SAAOX,GAAG,CAACW,MAAJ,CAAW,GAAX,EAAgBY,GAAhB,EAAP;AACD","sourcesContent":["import { db, admin } from '../../../lib/firebase';\nimport auth0 from '../../../lib/auth0';\nimport getCurrentDate from '../../../util/getCurrentDate';\n\nexport default async function store(req, res) {\n  const { symptoms = [], userId } = req.body;\n  const { latitude, longitude } = req.body.coords;\n  console.log(req.body);\n  const session = await auth0.getSession(req);\n\n  if (!session) return res.status(401).json({ error: 'Unauthenticated user' });\n\n  const currentDate = getCurrentDate();\n\n  // const { sub: userId } = session.user;\n\n  await db\n    .collection('users')\n    .doc(userId)\n    .collection('history')\n    .doc(currentDate)\n    .set({\n      symptoms,\n      status: 'covid',\n      coordinates: {\n        latitude,\n        longitude,\n      },\n    });\n\n  await db\n    .collection('history')\n    .doc(currentDate)\n    .collection('all')\n    .add({\n      user: userId,\n      symptoms,\n      coordinates: new admin.firestore.GeoPoint(latitude, longitude),\n      status: 'covid',\n    });\n\n  return res.status(200).end();\n}\n"]},"metadata":{},"sourceType":"module"}