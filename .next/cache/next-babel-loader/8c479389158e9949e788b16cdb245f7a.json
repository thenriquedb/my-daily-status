{"ast":null,"code":"import { db } from '../../lib/firebase';\nimport auth0 from '../../lib/auth0';\nimport getCurrentDate from '../../util/getCurrentDate';\nexport default async function (req, res) {\n  const {\n    filter,\n    latitude,\n    longitude\n  } = req.query;\n  const {\n    userId\n  } = req.headers;\n  /* Caso o usuário já tenha cadastrado seu status diário, será verificado\n   * todos os usúarios que estao proximos dele\n   */\n  // .where('status', '==', filter)\n\n  console.log('req.query: ', req.query);\n  const nearbyUsers = await db.collection('history').doc('2020-04-20').collection('all').near({\n    center: {\n      latitude,\n      longitude\n    },\n    radius: 10000\n  }).get();\n  const nearbyUsersList = [];\n  nearbyUsers.docs.forEach(doc => {\n    nearbyUsersList.push({\n      id: doc.id,\n      status: doc.data().status,\n      coordinates: {\n        latitude: doc.data().coordinates.latitude,\n        longitude: doc.data().coordinates.longitude\n      }\n    });\n  });\n  console.log(nearbyUsersList);\n  return res.status(200).json({\n    props: {\n      isAuth: true,\n      hasRegisteredDailyStatus: true,\n      // user: session.user,\n      nearbyUsers: nearbyUsersList\n    }\n  });\n}","map":{"version":3,"sources":["/home/thiago/Documentos/Dev/Projetos/fullstack-lab/pages/api/nearby-users.js"],"names":["db","auth0","getCurrentDate","req","res","filter","latitude","longitude","query","userId","headers","console","log","nearbyUsers","collection","doc","near","center","radius","get","nearbyUsersList","docs","forEach","push","id","status","data","coordinates","json","props","isAuth","hasRegisteredDailyStatus"],"mappings":"AAAA,SAASA,EAAT,QAAmB,oBAAnB;AACA,OAAOC,KAAP,MAAkB,iBAAlB;AAEA,OAAOC,cAAP,MAA2B,2BAA3B;AAEA,eAAe,gBAAgBC,GAAhB,EAAqBC,GAArB,EAA0B;AACvC,QAAM;AAAEC,IAAAA,MAAF;AAAUC,IAAAA,QAAV;AAAoBC,IAAAA;AAApB,MAAkCJ,GAAG,CAACK,KAA5C;AACA,QAAM;AAAEC,IAAAA;AAAF,MAAaN,GAAG,CAACO,OAAvB;AAEA;;;AAIA;;AACAC,EAAAA,OAAO,CAACC,GAAR,CAAY,aAAZ,EAA2BT,GAAG,CAACK,KAA/B;AAEA,QAAMK,WAAW,GAAG,MAAMb,EAAE,CACzBc,UADuB,CACZ,SADY,EAEvBC,GAFuB,CAEnB,YAFmB,EAGvBD,UAHuB,CAGZ,KAHY,EAIvBE,IAJuB,CAIlB;AACJC,IAAAA,MAAM,EAAE;AAAEX,MAAAA,QAAF;AAAYC,MAAAA;AAAZ,KADJ;AAEJW,IAAAA,MAAM,EAAE;AAFJ,GAJkB,EAQvBC,GARuB,EAA1B;AAUA,QAAMC,eAAe,GAAG,EAAxB;AAEAP,EAAAA,WAAW,CAACQ,IAAZ,CAAiBC,OAAjB,CAA0BP,GAAD,IAAS;AAChCK,IAAAA,eAAe,CAACG,IAAhB,CAAqB;AACnBC,MAAAA,EAAE,EAAET,GAAG,CAACS,EADW;AAEnBC,MAAAA,MAAM,EAAEV,GAAG,CAACW,IAAJ,GAAWD,MAFA;AAGnBE,MAAAA,WAAW,EAAE;AACXrB,QAAAA,QAAQ,EAAES,GAAG,CAACW,IAAJ,GAAWC,WAAX,CAAuBrB,QADtB;AAEXC,QAAAA,SAAS,EAAEQ,GAAG,CAACW,IAAJ,GAAWC,WAAX,CAAuBpB;AAFvB;AAHM,KAArB;AAQD,GATD;AAWAI,EAAAA,OAAO,CAACC,GAAR,CAAYQ,eAAZ;AACA,SAAOhB,GAAG,CAACqB,MAAJ,CAAW,GAAX,EAAgBG,IAAhB,CAAqB;AAC1BC,IAAAA,KAAK,EAAE;AACLC,MAAAA,MAAM,EAAE,IADH;AAELC,MAAAA,wBAAwB,EAAE,IAFrB;AAGL;AACAlB,MAAAA,WAAW,EAAEO;AAJR;AADmB,GAArB,CAAP;AAQD","sourcesContent":["import { db } from '../../lib/firebase';\nimport auth0 from '../../lib/auth0';\n\nimport getCurrentDate from '../../util/getCurrentDate';\n\nexport default async function (req, res) {\n  const { filter, latitude, longitude } = req.query;\n  const { userId } = req.headers;\n\n  /* Caso o usuário já tenha cadastrado seu status diário, será verificado\n   * todos os usúarios que estao proximos dele\n   */\n\n  // .where('status', '==', filter)\n  console.log('req.query: ', req.query);\n\n  const nearbyUsers = await db\n    .collection('history')\n    .doc('2020-04-20')\n    .collection('all')\n    .near({\n      center: { latitude, longitude },\n      radius: 10000,\n    })\n    .get();\n\n  const nearbyUsersList = [];\n\n  nearbyUsers.docs.forEach((doc) => {\n    nearbyUsersList.push({\n      id: doc.id,\n      status: doc.data().status,\n      coordinates: {\n        latitude: doc.data().coordinates.latitude,\n        longitude: doc.data().coordinates.longitude,\n      },\n    });\n  });\n\n  console.log(nearbyUsersList);\n  return res.status(200).json({\n    props: {\n      isAuth: true,\n      hasRegisteredDailyStatus: true,\n      // user: session.user,\n      nearbyUsers: nearbyUsersList,\n    },\n  });\n}\n"]},"metadata":{},"sourceType":"module"}