{"ast":null,"code":"import { db, admin } from '../../../lib/firebase';\nimport auth0 from '../../../lib/auth0';\nexport default async function store(req, res) {\n  const {\n    status\n  } = req.body;\n  const {\n    latitude,\n    longitude\n  } = req.body.coords;\n  const session = await auth0.getSession(req);\n  console.log(req.body);\n  console.log(session.user);\n  if (!session) return res.status(401).json({\n    error: 'Unauthenticated user'\n  });\n  const currentDate = new Date().toISOString().split('T')[0];\n  const {\n    sub: userId\n  } = session.user;\n  console.log(userId);\n  await db.collection('markers').doc(currentDate).collection('checks').doc(userId).set({\n    status,\n    userId,\n    coordinates: new admin.firestore.GeoPoint(latitude, longitude)\n  });\n  return res.send({\n    ok: true\n  });\n}","map":{"version":3,"sources":["/home/thiago/Documentos/Dev/Projetos/fullstack-lab/pages/api/status/store.js"],"names":["db","admin","auth0","store","req","res","status","body","latitude","longitude","coords","session","getSession","console","log","user","json","error","currentDate","Date","toISOString","split","sub","userId","collection","doc","set","coordinates","firestore","GeoPoint","send","ok"],"mappings":"AAAA,SAASA,EAAT,EAAaC,KAAb,QAA0B,uBAA1B;AACA,OAAOC,KAAP,MAAkB,oBAAlB;AAEA,eAAe,eAAeC,KAAf,CAAqBC,GAArB,EAA0BC,GAA1B,EAA+B;AAC5C,QAAM;AAAEC,IAAAA;AAAF,MAAaF,GAAG,CAACG,IAAvB;AACA,QAAM;AAAEC,IAAAA,QAAF;AAAYC,IAAAA;AAAZ,MAA0BL,GAAG,CAACG,IAAJ,CAASG,MAAzC;AAEA,QAAMC,OAAO,GAAG,MAAMT,KAAK,CAACU,UAAN,CAAiBR,GAAjB,CAAtB;AACAS,EAAAA,OAAO,CAACC,GAAR,CAAYV,GAAG,CAACG,IAAhB;AACAM,EAAAA,OAAO,CAACC,GAAR,CAAYH,OAAO,CAACI,IAApB;AACA,MAAI,CAACJ,OAAL,EAAc,OAAON,GAAG,CAACC,MAAJ,CAAW,GAAX,EAAgBU,IAAhB,CAAqB;AAAEC,IAAAA,KAAK,EAAE;AAAT,GAArB,CAAP;AACd,QAAMC,WAAW,GAAG,IAAIC,IAAJ,GAAWC,WAAX,GAAyBC,KAAzB,CAA+B,GAA/B,EAAoC,CAApC,CAApB;AACA,QAAM;AAAEC,IAAAA,GAAG,EAAEC;AAAP,MAAkBZ,OAAO,CAACI,IAAhC;AACAF,EAAAA,OAAO,CAACC,GAAR,CAAYS,MAAZ;AACA,QAAMvB,EAAE,CACLwB,UADG,CACQ,SADR,EAEHC,GAFG,CAECP,WAFD,EAGHM,UAHG,CAGQ,QAHR,EAIHC,GAJG,CAICF,MAJD,EAKHG,GALG,CAKC;AACHpB,IAAAA,MADG;AAEHiB,IAAAA,MAFG;AAGHI,IAAAA,WAAW,EAAE,IAAI1B,KAAK,CAAC2B,SAAN,CAAgBC,QAApB,CAA6BrB,QAA7B,EAAuCC,SAAvC;AAHV,GALD,CAAN;AAWA,SAAOJ,GAAG,CAACyB,IAAJ,CAAS;AAAEC,IAAAA,EAAE,EAAE;AAAN,GAAT,CAAP;AACD","sourcesContent":["import { db, admin } from '../../../lib/firebase';\nimport auth0 from '../../../lib/auth0';\n\nexport default async function store(req, res) {\n  const { status } = req.body;\n  const { latitude, longitude } = req.body.coords;\n\n  const session = await auth0.getSession(req);\n  console.log(req.body);\n  console.log(session.user);\n  if (!session) return res.status(401).json({ error: 'Unauthenticated user' });\n  const currentDate = new Date().toISOString().split('T')[0];\n  const { sub: userId } = session.user;\n  console.log(userId);\n  await db\n    .collection('markers')\n    .doc(currentDate)\n    .collection('checks')\n    .doc(userId)\n    .set({\n      status,\n      userId,\n      coordinates: new admin.firestore.GeoPoint(latitude, longitude),\n    });\n\n  return res.send({ ok: true });\n}\n"]},"metadata":{},"sourceType":"module"}