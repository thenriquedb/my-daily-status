{"version":3,"file":"static/webpack/static/development/pages/app.js.096f985db43010a6349b.hot-update.js","sources":["webpack:///./pages/app.js"],"sourcesContent":["import React, { useEffect } from 'react';\nimport Router from 'next/router';\nimport AppMenu from '../components/AppMenu';\nimport Loading from '../components/Loading';\n\nimport auth0 from '../lib/auth0';\nimport getCurrentDate from '../util/getCurrentDate';\nimport { db } from '../lib/firebase';\n\nimport '../styles/app.css';\n\nexport default function App({\n  isAuth,\n  hasRegisteredDailyStatus,\n  user,\n  nearbyUsersList = [],\n}) {\n  useEffect(() => {\n    if (!isAuth) Router.push('/');\n    if (!hasRegisteredDailyStatus) Router.push('/status');\n    // if (!nearbyUsersList)\n  }, [isAuth]);\n  console.log(nearbyUsersList);\n  if (isAuth) {\n    return (\n      <div className=\"app-container\">\n        <AppMenu user={user} />\n      </div>\n    );\n  }\n  return (\n    <div className=\"center-content fullscreen\">\n      <Loading />\n    </div>\n  );\n}\n\nexport async function getServerSideProps({ req, res }) {\n  const session = await auth0.getSession(req);\n\n  // Verifica se o usuário está logado\n  if (!session) {\n    return {\n      props: {\n        isAuth: false,\n      },\n    };\n  }\n\n  const currentDate = getCurrentDate();\n\n  const userDailyStatus = await db\n    .collection('markers')\n    .doc(currentDate)\n    .collection('checks')\n    .doc(session.user.sub)\n    .get();\n\n  const todayRegistered = userDailyStatus.data();\n\n  if (!todayRegistered) {\n    return {\n      props: {\n        isAuth: true,\n        hasRegisteredDailyStatus: false,\n        user: session.user,\n      },\n    };\n  }\n  // Caso o usuário já tenha cadastrado seu status diário, será verificado todos os\n  // usúarios que estao proximos dele\n  const { coordinates } = todayRegistered;\n\n  const nearbyUsers = await db\n    .collection('markers')\n    .doc(currentDate)\n    .collection('checks')\n    .near({\n      center: coordinates,\n      radius: 1000,\n    })\n    .get();\n\n  // nearbyUsers.forEach((doc) => {\n  //   console.log(doc.data());\n  //   console.log(doc.id);\n  // });\n\n  const nearbyUsersList = [];\n  nearbyUsers.docs.forEach((doc) => {\n    nearbyUsersList.push({\n      id: doc.id,\n      status: doc.data().status,\n      coordinates: {\n        longitude: doc.data().coordinates.longitude,\n        latitude: doc.data().coordinates.latitude,\n      },\n    });\n  });\n\n  return {\n    props: {\n      isAuth: true,\n      hasRegisteredDailyStatus: true,\n      user: session.user,\n      nearbyUsers: nearbyUsersList,\n    },\n  };\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AAMA;;AAEA;AAKA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;;;;A","sourceRoot":""}